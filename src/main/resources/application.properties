# ==========================================
# CONFIGURAÇÕES GERAIS
# ==========================================
spring.application.name=sistema-mapa-cidadao
server.port=${SERVER_PORT:8080}

# Tratamento de Erros
server.error.include-message=always
server.error.include-binding-errors=always

# ==========================================
# BANCO DE DADOS (Obrigatório configurar ENV)
# ==========================================
# Formato: jdbc:postgresql://HOST:PORTA/NOME_BANCO
spring.datasource.url=jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASS}
spring.datasource.driver-class-name=org.postgresql.Driver

# ==========================================
# JPA / HIBERNATE
# ==========================================
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
# Em produção use "validate" ou "none". Em dev use "update".
spring.jpa.hibernate.ddl-auto=${DDL_AUTO}
spring.jpa.show-sql=${SHOW_SQL}
spring.jpa.properties.hibernate.format_sql=true

# ==========================================
# SEGURANÇA E JWT
# ==========================================
# A chave secreta deve ser injetada. Sem ela, o app não sobe.
app.jwt.secret=${JWT_SECRET}
# Ex: 86400000 (24 horas)
app.jwt.expiration-ms=${JWT_EXPIRATION:86400000}

# ==========================================
# UPLOAD E STORAGE
# ==========================================
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=25MB

# Tipo: LOCAL ou S3 (futuro)
app.storage.type=${STORAGE_TYPE}
# Caminho da pasta (No Docker será /app/uploads)
app.storage.local-path=${STORAGE_PATH}

# ==========================================
# REGRAS DE NEGÓCIO
# ==========================================
app.token.duplicata.raio-metros=2
app.token.fotos.max-quantidade=5
app.token.fotos.max-tamanho-mb=50

# ==========================================
# INTEGRAÇÕES
# ==========================================
app.google.maps.api-key=${GOOGLE_MAPS_API_KEY}

# ==========================================
# DOCUMENTAÇÃO (Swagger)
# ==========================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=alpha


# --- CORREÇÃO DE QUEDA DE CONEXÃO (HIKARI) ---

# Tempo máximo que uma conexão fica viva no pool (2 minutos)
# O padrão é 30 min, o que é muito tempo para VPS instável
spring.datasource.hikari.max-lifetime=120000

# Tempo para testar se a conexão está viva (30 segundos)
spring.datasource.hikari.keepalive-time=30000

# Se a conexão ficar parada por 1 minuto, o Hikari joga fora
spring.datasource.hikari.idle-timeout=60000

# Número mínimo de conexões paradas (0 = não segura conexão à toa)
spring.datasource.hikari.minimum-idle=0

# Teste obrigatório antes de entregar a conexão pro sistema
spring.datasource.hikari.connection-test-query=SELECT 1

# Faz o Spring respeitar os cabeçalhos de HTTPS enviados pelo Nginx
server.forward-headers-strategy=framework

